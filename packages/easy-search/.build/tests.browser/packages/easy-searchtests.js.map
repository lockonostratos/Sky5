{"version":3,"file":"\\packages\\easy-search:tests.js","sources":["easy-search/tests\\easy-search-tests.js"],"names":[],"mappings":";;;;;;;;AAAA,4D;;AAEA,mB;AACA,4C;AACA,2C;AACA,G;;AAEA,sB;AACA,4B;;AAEA,mB;AACA,sD;AACA,yD;AACA,mD;;AAEA,iF;AACA,6B;AACA,uC;AACA,C;;AAEA,oC;AACA,sC;AACA,sC;AACA,K;AACA,G;;AAEA,Q;AACA,sF;AACA,uE;AACA,uE;AACA,gF;AACA,oF;;AAEA,0B;AACA,0H;AACA,K;;AAEA,+C;AACA,8B;AACA,iC;AACA,O;;AAEA,wE;AACA,sE;;AAEA,qD;AACA,0E;AACA,sE;AACA,G;;AAEA,sB;AACA,0E;AACA,oD;AACA,kC;AACA,uC;AACA,W;;AAEA,sF;AACA,oF;;AAEA,+E;AACA,kF;AACA,qF;AACA,O;;AAEA,qF;AACA,6E;AACA,sC;AACA,+D;AACA,wB;AACA,W;AACA,O;;AAEA,qF;AACA,sF;AACA,sC;AACA,4D;AACA,wB;AACA,W;AACA,O;AACA,6B;AACA,kE;AACA,2B;AACA,qC;AACA,W;;AAEA,+D;AACA,O;;AAEA,qE;AACA,oF;AACA,8D;AACA,O;;AAEA,qE;AACA,6E;AACA,2C;AACA,O;AACA,I;AACA,+F;AACA,2E;AACA,2C;AACA,M;;AAEA,wE;AACA,iC;AACA,mH;;AAEA,yC;AACA,iD;AACA,qC;AACA,W;;AAEA,yB;AACA,kG;;AAEA,sC;AACA,yC;AACA,qD;AACA,yC;AACA,e;AACA,W;;AAEA,sC;AACA,kD;AACA,W;AACA,O;AACA,C","sourcesContent":["var collection1 = new Meteor.Collection('estestCollection');\r\n\r\ncollection1.allow({\r\n    'insert' : function () { return true; },\r\n    'remove' : function () { return true; }\r\n});\r\n\r\nif (Meteor.isServer) {\r\n    collection1.remove({ });\r\n\r\n    // fixture data\r\n    collection1.insert({ 'name' : 'Super Pomodoro' });\r\n    collection1.insert({ 'name' : 'Awesome Testsauce' });\r\n    collection1.insert({ 'name' : 'David Rails' });\r\n\r\n    Meteor.publish('testCollection', function () { return collection1.find(); });\r\n} else if (Meteor.isClient) {\r\n    Meteor.subscribe('testCollection');\r\n}\r\n\r\ncollection1.initEasySearch('name', {\r\n    'permission' : function (string) {\r\n        return string !== 'Testsauce';\r\n    }\r\n});\r\n\r\n// Tests\r\nTinytest.add('EasySearch - createSearchIndex, getIndex, getIndexes', function (test) {\r\n    test.throws(function () { EasySearch.createSearchIndex({}, {}); });\r\n    test.throws(function () { EasySearch.createSearchIndex(10, {}); });\r\n    test.throws(function () { EasySearch.createSearchIndex('validName', 10); });\r\n    test.throws(function () { EasySearch.createSearchIndex(function () { }, {}); });\r\n\r\n    if (Meteor.isServer) {\r\n        test.expect_fail(function () { EasySearch.createSearchIndex('test', { 'field' : 'a', 'use' : 'doesntExist' }); });\r\n    }\r\n\r\n    EasySearch.createSearchIndex('testIndex', {\r\n        'field' : 'testField',\r\n        'customField' : [0, 1, 2]\r\n    });\r\n\r\n    test.equal(EasySearch.getIndex('testIndex').customField, [0, 1, 2]);\r\n    test.equal(EasySearch.getIndex('testIndex').field, ['testField']);\r\n\r\n    test.instanceOf(EasySearch.getIndexes(), Object);\r\n    test.equal(EasySearch.getIndexes()['testIndex'].field, ['testField']);\r\n    test.isUndefined(EasySearch.getIndexes()['indexThatDoesntExist']);\r\n});\r\n\r\nif (Meteor.isClient) {\r\n    Tinytest.add('EasySearch - Client - changeProperty', function (test) {\r\n        EasySearch.createSearchIndex('testIndex2', {\r\n            'field' : 'testField',\r\n            'customField' : 'isAString'\r\n        });\r\n\r\n        test.throws(function () { EasySearch.changeProperty('testIndex2', {}, {}); });\r\n        test.throws(function () { EasySearch.changeProperty({}, 'validKey', {}); });\r\n\r\n        test.equal(EasySearch.getIndex('testIndex2').customField, 'isAString');\r\n        EasySearch.changeProperty('testIndex2', 'customField', 'isAnotherString');\r\n        test.equal(EasySearch.getIndex('testIndex2').customField, 'isAnotherString');\r\n    });\r\n\r\n    Tinytest.addAsync('EasySearch - Client - search #1', function (test, completed) {\r\n        EasySearch.search('estestCollection', 'er Po', function (err, data) {\r\n            test.equal(data.total, 1);\r\n            test.equal(data.results[0].name, \"Super Pomodoro\");\r\n            completed();\r\n        });\r\n    });\r\n\r\n    Tinytest.addAsync('EasySearch - Client - search #2', function (test, completed) {\r\n        EasySearch.searchMultiple(['estestCollection'], 'id R', function (err, data) {\r\n            test.equal(data.total, 1);\r\n            test.equal(data.results[0].name, \"David Rails\");\r\n            completed();\r\n        });\r\n    });\r\n} else if (Meteor.isServer) {\r\n    Tinytest.add('EasySearch - Server - config', function (test) {\r\n        EasySearch.config({\r\n            'host' : 'localhost:8000'\r\n        });\r\n\r\n        test.equal(EasySearch.config().host, 'localhost:8000');\r\n    });\r\n\r\n    Tinytest.add('EasySearch - Server - search #1', function (test) {\r\n        var data = EasySearch.search('estestCollection', 'sauCE', { 'limit' : 10 });\r\n        test.equal(data.results[0].name, \"Awesome Testsauce\");\r\n    });\r\n\r\n    Tinytest.add('EasySearch - Server - search #2', function (test) {\r\n        var data = EasySearch.search('estestCollection', 'Super duper', { });\r\n        test.equal(data.results.length, 0);\r\n    });\r\n    \r\n    Tinytest.add('EasySearch - Server - search #3 (no permission to search)', function (test) {\r\n        var data = EasySearch.search('estestCollection', 'Testsauce', { });\r\n        test.equal(data.results.length, 0);\r\n    })\r\n\r\n    Tinytest.add('EasySearch - Server - extendSearch', function (test) {\r\n        // No solr implementation\r\n        test.expect_fail(function () { EasySearch.createSearchIndex('test', { 'field' : 'a', 'use' : 'solr' }); });\r\n\r\n        EasySearch.extendSearch('solr', {\r\n            'createSearchIndex' : function () {},\r\n            'search' : function () {}\r\n        });\r\n\r\n        // Now it has one\r\n        test.isUndefined(EasySearch.createSearchIndex('test', { 'field' : 'a', 'use' : 'solr' }));\r\n\r\n        test.expect_fail(function () {\r\n            EasySearch.extendSearch(10, {\r\n                'createSearchIndex' : function () {},\r\n                'search' : function () {}\r\n            });\r\n        });\r\n\r\n        test.expect_fail(function () {\r\n            EasySearch.extendSearch('lucene', {});\r\n        });\r\n    });\r\n}\r\n"]}